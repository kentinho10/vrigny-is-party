<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Librairie de Photos - La Kaz √† F√™te !</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<style>
  body { margin:0; font-family: 'Pacifico', cursive; background:#FAF9F6; color:#333; text-align:center; padding:1rem; }
  h1 { margin-bottom:1rem; font-size:2rem; color:#FFB347; cursor:pointer; }
  .upload-section { margin-bottom:1rem; }
  input[type="file"] { margin:0.5rem 0; }
  button {
    padding:0.5rem 1rem; border:none; background:#6F42C1; color:#fff; border-radius:5px; cursor:pointer;
    font-weight:600; transition: transform 0.2s;
  }
  button:hover { transform: scale(1.05); }
  .gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(200px,1fr));
    gap:12px;
    margin-top:1rem;
  }
  .gallery-item {
    position: relative;
    border-radius:8px;
    overflow: hidden;
    background:#fff;
    padding:4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  .gallery-item img {
    width:100%; height:200px;
    object-fit:cover;
    border-radius:6px;
    transition: transform 0.3s, box-shadow 0.3s;
    cursor:pointer;
  }
  .gallery-item img:hover { transform: scale(1.05); box-shadow: 0 0 15px #FFD700; }
  .btn-container {
    margin-top:4px;
    display:flex;
    justify-content:space-between;
    gap:4px;
  }
  .download-btn, .delete-btn {
    flex:1;
    padding:0.3rem 0.5rem;
    font-size:0.85rem;
    border:none;
    border-radius:5px;
    cursor:pointer;
    font-weight:600;
  }
  .download-btn { background:#FFD700; color:#111; text-decoration:none; }
  .delete-btn { background:#E74C3C; color:#fff; }
  .back-btn {
    display:block; margin:1rem auto; padding:0.5rem 1rem; background:#000; color:#fff; text-decoration:none; border-radius:5px; width:120px; text-align:center;
  }
</style>
</head>
<body>

<h1>Librairie de Photos üå¥</h1>
<a href="index.html" class="back-btn">‚Üê Accueil</a>

<div class="upload-section">
  <input type="file" id="photoInput" accept="image/*" multiple>
  <button id="uploadBtn">Ajouter</button>
</div>

<div class="gallery" id="gallery"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
// Configuration Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBq5OSHZzq6mixYfDrlfJHg397VjO_Plyc",
  authDomain: "kazafete-627b7.firebaseapp.com",
  databaseURL: "https://kazafete-627b7-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "kazafete-627b7",
  storageBucket: "kazafete-627b7.appspot.com",
  messagingSenderId: "1009736388412",
  appId: "1:1009736388412:web:62f833aa444f0d30909839"
};

// Initialisation Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

const input = document.getElementById('photoInput');
const btn = document.getElementById('uploadBtn');
const gallery = document.getElementById('gallery');

// Afficher les photos depuis Firebase
function displayPhotos() {
  gallery.innerHTML = '';
  db.ref('photos').once('value', snapshot => {
    const photos = snapshot.val() || [];
    photos.forEach((photo, i) => {
      const item = document.createElement('div');
      item.className = 'gallery-item';
      item.innerHTML = `
        <img src="${photo}" alt="Photo #${i+1}">
        <div class="btn-container">
          <a href="${photo}" download="photo${i+1}.jpg" class="download-btn">T√©l√©charger</a>
          <button class="delete-btn" onclick="deletePhoto(${i})">Supprimer</button>
        </div>
      `;
      gallery.appendChild(item);
    });
  });
}

// Ajouter des photos
btn.addEventListener('click', () => {
  const files = input.files;
  if(!files.length) return alert("S√©lectionne au moins une photo !");

  Array.from(files).forEach(file => {
    const storageRef = storage.ref('photos/' + Date.now() + '_' + file.name);
    storageRef.put(file).then(snapshot => {
      snapshot.ref.getDownloadURL().then(url => {
        db.ref('photos').once('value', snap => {
          const photos = snap.val() || [];
          photos.push(url);
          db.ref('photos').set(photos);
          displayPhotos();
        });
      });
    });
  });
  input.value = '';
});

// Supprimer une photo
function deletePhoto(index) {
  if(!confirm("Supprimer cette photo ?")) return;

  db.ref('photos').once('value', snapshot => {
    const photos = snapshot.val() || [];
    const url = photos[index];
    if(!url) return;

    // Supprimer du Storage
    storage.refFromURL(url).delete().then(() => {
      photos.splice(index,1);
      db.ref('photos').set(photos);
      displayPhotos();
    }).catch(err => console.error(err));
  });
}

// Rafra√Æchir √† chaque changement
db.ref('photos').on('value', displayPhotos);

</script>

</body>
</html>
