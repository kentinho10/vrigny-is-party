<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Admin ‚Äì Gestion du classement</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing:border-box; margin:0; padding:0; }
    body {
      font-family: 'Montserrat', sans-serif;
      background:#FAF9F6; color:#333;
      padding:1rem;
    }
    header { text-align:center; margin-bottom:1rem; }
    header h1 {
      font-family:'Pacifico', cursive;
      color:#6F42C1; font-size:2rem;
    }
    .actions { text-align:center; margin-bottom:1rem; }
    .actions button {
      padding:.5rem 1rem; background:#6F42C1; color:#fff;
      border:none; border-radius:4px; cursor:pointer;
    }
    table {
      width:100%; border-collapse:collapse; margin-bottom:1rem;
    }
    th, td {
      padding:.75rem; border:1px solid #ddd; text-align:center;
    }
    th { background:#fafafa; }
    .avatar {
      width:40px; height:40px; border-radius:50%;
      object-fit:cover; vertical-align:middle;
    }
    .form-admin {
      display:flex; flex-wrap:wrap; gap:.5rem;
      align-items:flex-end; justify-content:center;
      margin-bottom:2rem;
    }
    .form-admin label {
      display:flex; flex-direction:column;
      font-size:.9rem; flex:1; min-width:120px;
    }
    .form-admin input {
      margin-top:.25rem; padding:.5rem; font-size:1rem;
    }
    .form-admin button {
      padding:.5rem 1rem; font-size:1rem;
      background:#6F42C1; color:#fff; border:none;
      border-radius:4px; cursor:pointer;
    }
    .edit-btn, .del-btn {
      background:transparent; border:none; cursor:pointer;
      font-size:1.1rem; margin:0 .25rem;
    }
  </style>
</head>
<body>

  <header><h1>Admin ‚Äì Classement</h1></header>

  <div class="actions">
    <button type="button" onclick="location.href='index.html'">‚Üê Accueil</button>
  </div>

  <table id="admin-table">
    <thead>
      <tr>
        <th>Avatar</th><th>Nom</th><th>Points</th><th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="form-admin">
    <label>
      Photo (facultatif)
      <input type="file" id="new-avatar" accept="image/*">
    </label>
    <label>
      Nom
      <input type="text" id="new-name" placeholder="Nom du joueur">
    </label>
    <label>
      Points
      <input type="number" id="new-score" placeholder="Points">
    </label>
    <button type="button" id="save-btn">Ajouter</button>
  </div>

  <script>
    let players = JSON.parse(localStorage.getItem('players')||'[]');
    let editIndex = null;

    const tbody = document.querySelector('#admin-table tbody');
    const fileInput = document.getElementById('new-avatar');
    const nameInput = document.getElementById('new-name');
    const scoreInput = document.getElementById('new-score');
    const saveBtn = document.getElementById('save-btn');

    function renderAdmin() {
      tbody.innerHTML = '';
      players.forEach((p,i) => {
        const tr = document.createElement('tr');
        const img = p.avatar
          ? `<img src="${p.avatar}" class="avatar" alt="${p.name}">`
          : '';
        tr.innerHTML = `
          <td>${img}</td>
          <td>${p.name}</td>
          <td>${p.score}</td>
          <td>
            <button class="edit-btn" title="√âditer" onclick="startEdit(${i})">‚úèÔ∏è</button>
            <button class="del-btn"  title="Supprimer" onclick="del(${i})">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function startEdit(i) {
      editIndex = i;
      const p = players[i];
      nameInput.value = p.name;
      scoreInput.value = p.score;
      saveBtn.textContent = 'Mettre √† jour';
    }

    function del(i) {
      if(!confirm(`Supprimer ${players[i].name} ?`)) return;
      players.splice(i,1);
      localStorage.setItem('players', JSON.stringify(players));
      renderAdmin();
    }

    function save() {
      const name = nameInput.value.trim();
      const score = parseInt(scoreInput.value,10);
      if(!name || isNaN(score)) {
        alert('Nom et points requis');
        return;
      }
      function finalize(avatarData) {
        if(editIndex===null) {
          players.push({name, score, avatar: avatarData});
        } else {
          players[editIndex].name = name;
          players[editIndex].score = score;
          if(avatarData!==null) players[editIndex].avatar = avatarData;
        }
        localStorage.setItem('players', JSON.stringify(players));
        resetForm();
        renderAdmin();
        editIndex = null;
        saveBtn.textContent = 'Ajouter';
      }
      if(fileInput.files.length) {
        const reader = new FileReader();
        reader.onload = () => finalize(reader.result);
        reader.readAsDataURL(fileInput.files[0]);
      } else {
        finalize(null);
      }
    }

    function resetForm() {
      fileInput.value = '';
      nameInput.value = '';
      scoreInput.value = '';
    }

    saveBtn.addEventListener('click', save);

    // initial render
    renderAdmin();
  </script>

</body>
</html>
